# TSK Ink 功能使用说明

## 功能简介

图谱Ink功能用于自动检测并标记"可疑"的Pass Die。当某颗良品Die被大量不良品包围时，该Die可能存在潜在问题但未被检测到，通过Ink功能可以将其标记为不良品，提高良率分析的准确性。

## 适用场景

- 半导体晶圆测试数据分析
- 良率异常分析
- 区域性不良点识别
- 假性Pass Die筛选

## 启动方式

1. 打开 WindowsFormTool-HT 应用程序
2. 在功能下拉框中选择 **"INK规则"**
3. 点击 **"选择TSK文件"** 按钮，加载待处理的TSK文件

## 规则说明

### 十字围点规则

检测被Fail Die包围的Pass Die，将其标记为指定Bin号。

**模式1：纯Fail包围**
- 条件：某颗Pass Die的 **上下左右四颗Die全部是不良品（Fail Die）**
- 处理：将该Pass Die标记为指定Bin号

**模式2：含Mark Fail包围**
- 条件：某颗Pass Die的 **上下左右四颗Die中有1-3颗是Mark Die，其余是不良品**
- 处理：将该Pass Die标记为指定Bin号

**参数配置：**
- 目标Bin号：输入1-255之间的整数（默认63）
- 模式选择：勾选使用的模式（可多选）

### 九宫格规则

检测3×3区域内的Fail Die，将周围的Pass Die标记为指定Bin号。

**原理：**
- 以每个Die为中心，检查其周围3×3区域内是否存在Fail Die
- 如果存在Fail Die，将该区域内其他Pass Die标记为指定Bin号
- 支持1-3圈迭代处理

**参数配置：**
- 目标Bin号：输入1-255之间的整数（默认63）
- INK圈数：选择1、2或3圈（默认1圈）

## 使用步骤

### 步骤1：选择功能

在主界面的下拉框中选择 **"INK规则"**。

```
┌─────────────────────────────────────┐
│ 功能选择                    ┌────┐  │
│                             │▼   │  │
└─────────────────────────────────────┘
```

### 步骤2：加载TSK文件

点击 **"选择TSK文件"** 按钮，在弹出的文件选择对话框中选择要处理的TSK文件。

```
┌─────────────────────────────────────┐
│ 已加载：WAFER001.tsk           [选择TSK文件]│
└─────────────────────────────────────┘
```

### 步骤3：配置规则

点击 **"执行INK"** 按钮，弹出INK规则配置对话框。

```
┌─────────────────────────────────────────────┐
│ INK规则设置                              X │
├─────────────────────────────────────────────┤
│ 选择规则：                        ┌────┐   │
│                                   │▼   │   │
├─────────────────────────────────────────────┤
│ 目标Bin号：                     [  63  ]   │
├─────────────────────────────────────────────┤
│ 十字围点模式                              │
│ ○ 模式1：纯Fail包围（上下左右四颗均为Fail Die）│
│ ○ 模式2：含Mark Fail包围（1-3颗Mark Die + 其余Fail）│
├─────────────────────────────────────────────┤
│ 预览结果：                                 │
│ 将INK 15 颗Die                            │
│ 坐标列表：                                 │
│ (5,5), (6,6), (7,7)...                    │
├─────────────────────────────────────────────┤
│          [预览]  [应用]  [取消]             │
└─────────────────────────────────────────────┘
```

### 步骤4：预览结果

点击 **"预览"** 按钮，查看将被INK的Die数量和坐标列表，确认是否符合预期。

**预览信息包括：**
- 将要INK的Die总数
- 坐标列表（前50个）
- 如果超过50个，显示"还有X颗"

### 步骤5：应用规则

确认预览结果后，点击 **"应用"** 按钮执行INK操作。

系统会：
1. 扫描整个Die矩阵
2. 识别满足条件的Pass Die
3. 修改这些Die的Bin号和属性
4. 生成处理结果统计

### 步骤6：保存结果

INK处理完成后，弹出确认对话框：

```
┌─────────────────────────────────────────────────┐
│ 完成                                              │
├─────────────────────────────────────────────────┤
│ INK处理完成，共INK 15 颗Die。                      │
│                                                  │
│ 是否保存修改后的TSK文件？                          │
│                                                  │
│              [是]  [否]                           │
└─────────────────────────────────────────────────┘
```

- 点击 **"是"**：选择保存路径，保存修改后的TSK文件
- 点击 **"否"**：不保存，仅查看结果

## 结果统计

处理完成后，日志区域会显示统计信息：

```
正在加载TSK文件...
正在应用INK规则：十字围点
参数：目标Bin=63
INK处理完成：共INK 15 颗Die（Bin 1→63: 15颗）
耗时：125ms
```

## 常见问题

### Q1: 边缘的Die会被INK吗？

**不会。** 边缘Die由于缺少部分邻域，无法满足"四邻域均为Fail"的条件，因此不会触发任何INK规则。

### Q2: Mark Die会被INK吗？

**不会。** Mark Die本身不是Pass Die（Bin ≠ 1），不会被选为INK目标。但Mark Die会参与包围判断。

### Q3: 如何撤销INK操作？

**INK操作不可撤销。** 建议在执行INK前先预览结果，确认无误后再应用。如需保留原文件，请在保存时使用新文件名。

### Q4: 为什么选择63作为默认Bin号？

63是半导体行业常用的"特殊Bin号"，用于标识需要特殊处理的Die。您可以根据实际需求设置为其他值。

### Q5: 多圈迭代有什么区别？

以九宫格规则为例：
- **1圈**：只INK紧邻Fail区域的Pass Die
- **2圈**：第一圈基础上，INK靠近第一圈的区域
- **3圈**：继续向外扩展

圈数越多，被INK的Die范围越大。

## 注意事项

1. **备份原文件**：建议处理前备份原始TSK文件
2. **先预览后应用**：养成先预览再应用的习惯
3. **参数范围**：目标Bin号必须在1-255之间
4. **保存确认**：保存前确认文件路径，避免覆盖原文件
5. **不可逆操作**：INK修改直接生效且不可撤销

---

**版本**: 1.0.0
**更新日期**: 2026-01-28
